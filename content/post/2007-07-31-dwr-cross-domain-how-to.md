---
author: Diego Parrilla
blogger_author:
- Diego Parrilla
blogger_blog:
- www.diegoparrilla.com
blogger_permalink:
- /2007/07/dwr-cross-domain-how-to-dwr-is-most.html
categories:
- Uncategorized
date: 2007-07-31T18:04:00Z
dsq_thread_id:
- "204894810"
guid: /2007/07/dwr-cross-domain-how-to/
id: 1227
title: DWR Cross Domain How to
url: /2007/07/31/dwr-cross-domain-how-to/
---

<div style="float: right; margin-left: 10px;">
  <a href="https://twitter.com/share" class="twitter-share-button" data-via="nubeblog" data-count="vertical" data-url="/2007/07/31/dwr-cross-domain-how-to/">Tweet</a>
</div>

[DWR](http://getahead.org/dwr "DWR") is the most popular framework to develop AJAX-style Web Applications in Java. It&#8217;s very mature and you can rarely find bugs or unexpected behaviours. I have been performing some tests with DWR in an environment without standard java server-side code (JSPs, JSFs, Servlets and web frameworks like Struts, Webwork&#8230;). All the code was static HTML, javascript and DWR dynamically generated javascript. The static content was served by Apache, and DWR code was served by Tomcat. Nothing shocking. But I did not want to use mod\_jk or mod\_proxy to serve Tomcat through Apache. So I assigned different names to the servers as follows: 

  * Apache: static.myexample.com
  * Tomcat: dynamic.myexample.com

Cross domain is always an issue and DWR claims it can manage it, but it&#8217;s not easy because there is not enough information about how to do it. Let&#8217;s start with the different remoting schemas: 

  * XMLHttpRequest: Works in most cases.
  * IFrame: Use it if you don&#8217;t have activeX enabled (DWR detects it automatically&#8230;)
  * ScriptTag: New in version 2.0, bypass cross-domain restrictions. ScriptTag is a must if you want a cross domain environment, so I will use it.

ScriptTag needs some extra configuration in the web.xml file to relax the security restrictions of the DWR framework:  
<span style="font-size:85%;"><br /></span> 

<div style="text-align: center;">
  <table style="text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="3" cellspacing="0" height="298" width="623">
    <tr>
      <td width="100%">
        <span style=";font-family:Courier New;font-size:85%;"> <servlet></servlet></span><span style="font-size:85%;"> </span><span style=";font-family:Courier New;font-size:85%;"> <servlet-name>dwr</servlet-name></span><span style="font-size:85%;"> </span><span style=";font-family:Courier New;font-size:85%;"> <servlet-class></servlet-class></span><span style="font-size:85%;"> </span><span style=";font-family:Courier New;font-size:85%;"> org.directwebremoting.spring.DwrSpringServlet</span><span style="font-size:85%;"> </span><span style=";font-family:Courier New;font-size:85%;"> </span><span style="font-size:85%;"> </span><span style=";font-family:Courier New;font-size:85%;"> <init-param></init-param></span> <span style=";font-family:Courier New;font-size:85%;"> 
        
        <param-name />
        debug</param-name></span>
        <span style="font-size:85%;"> </span><span style=";font-family:Courier New;font-size:85%;"> 
        
        <param-value />
        false</param-value></span>
        <span style="font-size:85%;"> </span><span style=";font-family:Courier New;font-size:85%;"> </span><span style="font-size:85%;"> </span><span style="color: rgb(51, 51, 255);font-size:85%;"><span style="font-family:Courier New;"> <init-param></init-param></span> <span style="font-family:Courier New;"> 
        
        <param-name />
        crossDomainSessionSecurity</param-name></span> 
        <span style="font-family:Courier New;"> 
        
        <param-value />
        false</param-value></span> 
        <span style="font-family:Courier New;"> </span> <span style="font-family:Courier New;"> <init-param></init-param></span> <span style="font-family:Courier New;"> 
        
        <param-name />
        allowGetForSafariButMakeForgeryEasier</param-name></span> 
        <span style="font-family:Courier New;"> 
        
        <param-value />
        true</param-value></span> 
        <span style="font-family:Courier New;"> </span></span><span style="font-size:85%;"> </span><span style=";font-family:Courier New;font-size:85%;"> </span>
      </td>
    </tr>
  </table>
</div>

<span style="font-family:Courier New;"></span>  
crossDomainSessionSecurity restricts cross domain remote access if true, and allowGetForSafariButMakeForgeryEasier seems to be mandatory when using the remoting ScriptTag schema. As you can read, I&#8217;m using Spring as the DWR Servlet, but you can ignore it and use the default DWR Servlet.

And here comes the most painful part of the configuration: how can I pass to the DWR javascript client where is the new remote server? No&#8230; there is no method to do this! Digging into the code generated by DWR, there is a javascript variable called:

<div style="text-align: center;">
  <table style="text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="3" cellspacing="0">
    <tr>
      <td>
        <span style=";font-family:Courier New;font-size:85%;"><yourserversidedwrclass>._path;</yourserversidedwrclass></span>
      </td>
    </tr>
  </table>
</div>

<span style="font-family:Courier New;"></span>  
You must pass here the URL where DWR is listening. In our example:

<div style="text-align: center;">
</div>

<table style="text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="3" cellspacing="0">
  <tr>
    <td>
      <span style=";font-family:Courier New;font-size:85%;"><yourserversidedwrclass>._path = &#8220;http://dynamic.myexample.com/<your_webapp>/<your_dwr_servlet>&#8220;;</your_dwr_servlet></your_webapp></yourserversidedwrclass></span><span style=";font-family:Courier New;font-size:85%;"></span>
    </td>
  </tr>
</table>

<span style="font-family:Courier New;"></span>  
By default, the remoting schema is XMLHttpRequest, but we need to use the ScriptTag schema. So don&#8217;t forget to add the Rpc Type as follows:

<div style="text-align: center;">
</div>

<table style="text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="3" cellspacing="0">
  <tr>
    <td>
      <span style="font-family:Courier New;"></span><span style=";font-family:Courier New;font-size:85%;">dwr.engine.setRpcType(dwr.engine.ScriptTag);</span><span style=";font-family:Courier New;font-size:85%;"></span>
    </td>
  </tr>
</table>

<span style=";font-family:Courier New;font-size:85%;"></span><span style="font-family:Courier New;"><br /><span style="font-family:Arial;">So, the code should look like this:</span></p> 

<p>
  </span><br /> 
  
  <table style="text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="3" cellspacing="0">
    <tr>
      <td>
        <span style=";font-family:Courier New;font-size:85%;"><br /><br /><br /></span><span style=";font-family:Courier New;font-size:85%;"><br /></span><span style=";font-family:Courier New;font-size:85%;"><br /></span><span style=";font-family:Courier New;font-size:85%;"><br /><br /></span></p>
      </td>
    </tr>
  </table>
  
  <div style="text-align: center;">
    <div style="text-align: left;">
      Now it&#8217;s working for my tests. I have also tested something similar inside a GreaseMonkey script and it works. I&#8217;m facing an issue with BASIC Authentication and Acegi. It works perfect with XmlHttpRequest remoting but fails with ScriptTag. I have not tested reverse Ajax yet, but probably it will work.
    </div>
    
    <p>
      <span style="font-family:Courier New;"></span><br /><span style="font-family:Courier New;"></span><br /><span style="font-family:Courier New;"></span></div>
